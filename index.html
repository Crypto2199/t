<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>لعبة القفز - الضفدع</title>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(#99ccff, #3366cc);
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      height: 100vh;
    }
    .start-screen, .game-over-screen, .countdown-screen {
      position: fixed;
      width: 100vw;
      height: 100vh;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      z-index: 10;
      text-align: center;
      padding: 20px;
    }
    .start-btn, .restart-btn, .back-btn {
      padding: 12px 24px;
      font-size: 18px;
      background: #28a745;
      color: #fff;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      margin: 10px;
      transition: 0.3s;
    }
    .start-btn:hover, .restart-btn:hover, .back-btn:hover {
      background: #218838;
    }
    .game {
      position: relative;
      width: 100%;
      max-width: 700px;
      height: 350px;
      background: #ffffff;
      border: 4px solid #333;
      overflow: hidden;
      box-shadow: 0 0 15px rgba(0,0,0,0.4);
    }
    .player {
      position: absolute;
      width: 60px;
      height: 60px;
      background-image: url('frog.png');
      background-size: cover;
      bottom: 0;
      left: 60px;
    }
    .obstacle {
      position: absolute;
      width: 40px;
      height: 60px;
      background-size: cover;
      background-position: center;
      bottom: 0;
      right: -60px;
      animation: moveObstacle 2s linear infinite;
    }
    @keyframes moveObstacle {
      0%   { right: -60px; }
      100% { right: 740px; }
    }
    .jump {
      animation: jump 0.5s ease-out;
      filter: drop-shadow(0 0 10px yellow);
    }
    @keyframes jump {
      0%   { bottom: 0; }
      50%  { bottom: 130px; }
      100% { bottom: 0; }
    }
    .flash {
      animation: flashRed 0.3s;
    }
    @keyframes flashRed {
      0% { background-color: red; }
      100% { background-color: white; }
    }
    #score, #highScore {
      position: absolute;
      top: 10px;
      left: 10px;
      font-size: 18px;
      font-weight: bold;
      color: #222;
      z-index: 1;
    }
    #highScore {
      top: 35px;
      color: #008000;
    }
    .countdown-number {
      font-size: 100px;
      animation: pulse 1s infinite;
    }
    @keyframes pulse {
      0% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.5); opacity: 0.5; }
      100% { transform: scale(1); opacity: 1; }
    }
    @media (max-width: 768px) {
      .game {
        height: 250px;
      }
      .player {
        width: 45px;
        height: 45px;
      }
      .obstacle {
        width: 30px;
        height: 45px;
      }
    }
  </style>
</head>
<body>
  <div class="start-screen" id="startScreen">
    <h1>🐸 لعبة القفز: الضفدع</h1>
    <p>اقفز لتفادي العقبات وحقق أعلى نتيجة!</p>
    <button class="start-btn" onclick="startCountdown()">ابدأ اللعبة</button>
  </div>

  <div class="countdown-screen" id="countdownScreen" style="display:none">
    <div class="countdown-number" id="countdownNumber">3</div>
  </div>

  <div class="game" id="game" style="display:none">
    <div class="player" id="player"></div>
    <div class="obstacle" id="obstacle"></div>
    <div id="score">النقاط: 0</div>
    <div id="highScore">الأعلى: 0</div>
  </div>

  <div class="game-over-screen" id="gameOverScreen" style="display:none">
    <h2>انتهت اللعبة!</h2>
    <p id="finalScore"></p>
    <button class="restart-btn" onclick="restartGame()">إعادة المحاولة</button>
    <button class="back-btn" onclick="goBackToStart()">رجوع</button>
  </div>

  <audio id="jumpSound" src="jump.mp3"></audio>
  <audio id="failSound" src="fail.mp3"></audio>
  <audio id="bgMusic" src="bgmusic.mp3" loop></audio>

  <script>
    const startScreen = document.getElementById("startScreen");
    const countdownScreen = document.getElementById("countdownScreen");
    const countdownNumber = document.getElementById("countdownNumber");
    const gameOverScreen = document.getElementById("gameOverScreen");
    const finalScore = document.getElementById("finalScore");
    const game = document.getElementById("game");
    const player = document.getElementById("player");
    const obstacle = document.getElementById("obstacle");
    const scoreDisplay = document.getElementById("score");
    const highScoreDisplay = document.getElementById("highScore");
    const jumpSound = document.getElementById("jumpSound");
    const failSound = document.getElementById("failSound");
    const bgMusic = document.getElementById("bgMusic");

    let score = 0;
    let highScore = localStorage.getItem("highScore") || 0;
    let isGameOver = false;
    let scoreInterval;
    let speed = 2;
    const obstacleImages = ['rock.png', 'bush.png', 'snail.png'];

    highScoreDisplay.textContent = `الأعلى: ${highScore}`;

    function startCountdown() {
      startScreen.style.display = "none";
      countdownScreen.style.display = "flex";
      let count = 3;
      countdownNumber.textContent = count;

      const interval = setInterval(() => {
        count--;
        if (count === 0) {
          clearInterval(interval);
          countdownScreen.style.display = "none";
          startGame();
        } else {
          countdownNumber.textContent = count;
        }
      }, 1000);
    }

    function startGame() {
      game.style.display = "block";
      bgMusic.volume = 0.4;
      bgMusic.play();
      startScoring();
    }

    function jump() {
      if (!player.classList.contains("jump") && !isGameOver) {
        player.classList.add("jump");
        jumpSound.currentTime = 0;
        jumpSound.play();
        setTimeout(() => {
          player.classList.remove("jump");
        }, 500);
      }
    }

    document.addEventListener("keydown", (e) => {
      if (e.code === "Space") jump();
    });
    document.addEventListener("click", jump);

    function startScoring() {
      score = 0;
      speed = 3;
      obstacle.style.animation = `moveObstacle ${speed}s linear infinite`;
      updateObstacleImage();
      scoreInterval = setInterval(() => {
        score++;
        scoreDisplay.textContent = `النقاط: ${score}`;
        if (score % 100 === 0 && speed > 1.2) {
          speed -= 0.2;
          obstacle.style.animation = `moveObstacle ${speed}s linear infinite`;
        }
        if (score % 20 === 0) {
          updateObstacleImage();
        }
      }, 1000);
    }

    function updateObstacleImage() {
      const img = obstacleImages[Math.floor(Math.random() * obstacleImages.length)];
      obstacle.style.backgroundImage = `url('${img}')`;
    }

    let checkCollision = setInterval(() => {
      const playerBottom = parseInt(window.getComputedStyle(player).getPropertyValue("bottom"));
      const obstacleRight = parseInt(window.getComputedStyle(obstacle).getPropertyValue("right"));

      if (obstacleRight > 60 && obstacleRight < 130 && playerBottom < 60 && !isGameOver) {
        endGame();
      }
    }, 10);

    function endGame() {
      isGameOver = true;
      clearInterval(scoreInterval);
      failSound.play();
      bgMusic.pause();
      game.classList.add("flash");
      setTimeout(() => game.classList.remove("flash"), 200);
      obstacle.style.animation = "none";
      obstacle.style.right = window.getComputedStyle(obstacle).getPropertyValue("right");
      finalScore.textContent = `نتيجتك: ${score}`;
      gameOverScreen.style.display = "flex";

      if (score > highScore) {
        localStorage.setItem("highScore", score);
        highScoreDisplay.textContent = `الأعلى: ${score}`;
      }
    }

    function restartGame() {
      isGameOver = false;
      score = 0;
      scoreDisplay.textContent = `النقاط: 0`;
      gameOverScreen.style.display = "none";
      obstacle.style.animation = `moveObstacle ${speed}s linear infinite`;
      bgMusic.currentTime = 0;
      bgMusic.play();
      startScoring();
    }

    function goBackToStart() {
      gameOverScreen.style.display = "none";
      game.style.display = "none";
      startScreen.style.display = "flex";
      bgMusic.pause();
    }
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ŸÑÿπÿ®ÿ© ÿßŸÑŸÇŸÅÿ≤ - ÿßŸÑÿ∂ŸÅÿØÿπ</title>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(#99ccff, #3366cc);
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      height: 100vh;
    }
    .start-screen, .game-over-screen, .countdown-screen {
      position: fixed;
      width: 100vw;
      height: 100vh;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      z-index: 10;
      text-align: center;
      padding: 20px;
    }
    .start-btn, .restart-btn, .back-btn {
      padding: 12px 24px;
      font-size: 18px;
      background: #28a745;
      color: #fff;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      margin: 10px;
      transition: 0.3s;
    }
    .start-btn:hover, .restart-btn:hover, .back-btn:hover {
      background: #218838;
    }
    .game {
      position: relative;
      width: 100%;
      max-width: 700px;
      height: 350px;
      background: #ffffff;
      border: 4px solid #333;
      overflow: hidden;
      box-shadow: 0 0 15px rgba(0,0,0,0.4);
    }
    .player {
      position: absolute;
      width: 60px;
      height: 60px;
      background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="40" fill="green"/><circle cx="35" cy="40" r="5" fill="white"/><circle cx="65" cy="40" r="5" fill="white"/><circle cx="35" cy="40" r="2" fill="black"/><circle cx="65" cy="40" r="2" fill="black"/><path d="M30 65 Q50 80 70 65" stroke="black" stroke-width="2" fill="none"/></svg>');
      background-size: cover;
      bottom: 0;
      left: 60px;
    }
    .obstacle {
      position: absolute;
      width: 40px;
      height: 60px;
      background-size: cover;
      background-position: center;
      bottom: 0;
      right: -60px;
      display: none;
      background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect x="20" y="40" width="60" height="60" fill="gray"/></svg>');
    }
    @keyframes moveObstacle {
      0%   { right: -60px; }
      100% { right: 740px; }
    }
    .jump {
      animation: jump 0.5s ease-out;
      filter: drop-shadow(0 0 10px yellow);
    }
    @keyframes jump {
      0%   { bottom: 0; }
      50%  { bottom: 130px; }
      100% { bottom: 0; }
    }
    .flash {
      animation: flashRed 0.3s;
    }
    @keyframes flashRed {
      0% { background-color: red; }
      100% { background-color: white; }
    }
    #score, #highScore {
      position: absolute;
      top: 10px;
      left: 10px;
      font-size: 18px;
      font-weight: bold;
      color: #222;
      z-index: 1;
    }
    #highScore {
      top: 35px;
      color: #008000;
    }
    .countdown-number {
      font-size: 100px;
      animation: pulse 1s infinite;
    }
    @keyframes pulse {
      0% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.5); opacity: 0.5; }
      100% { transform: scale(1); opacity: 1; }
    }
    @media (max-width: 768px) {
      .game {
        height: 250px;
      }
      .player {
        width: 45px;
        height: 45px;
      }
      .obstacle {
        width: 30px;
        height: 45px;
      }
    }
  </style>
</head>
<body>
  <div class="start-screen" id="startScreen">
    <h1>üê∏ ŸÑÿπÿ®ÿ© ÿßŸÑŸÇŸÅÿ≤: ÿßŸÑÿ∂ŸÅÿØÿπ</h1>
    <p>ÿßŸÇŸÅÿ≤ ŸÑÿ™ŸÅÿßÿØŸä ÿßŸÑÿπŸÇÿ®ÿßÿ™ Ÿàÿ≠ŸÇŸÇ ÿ£ÿπŸÑŸâ ŸÜÿ™Ÿäÿ¨ÿ©!</p>
    <button class="start-btn" onclick="startCountdown()">ÿßÿ®ÿØÿ£ ÿßŸÑŸÑÿπÿ®ÿ©</button>
  </div>

  <div class="countdown-screen" id="countdownScreen" style="display:none">
    <div class="countdown-number" id="countdownNumber">3</div>
  </div>

  <div class="game" id="game" style="display:none">
    <div class="player" id="player"></div>
    <div class="obstacle" id="obstacle"></div>
    <div id="score">ÿßŸÑŸÜŸÇÿßÿ∑: 0</div>
    <div id="highScore">ÿßŸÑÿ£ÿπŸÑŸâ: 0</div>
  </div>

  <div class="game-over-screen" id="gameOverScreen" style="display:none">
    <h2>ÿßŸÜÿ™Ÿáÿ™ ÿßŸÑŸÑÿπÿ®ÿ©!</h2>
    <p id="finalScore"></p>
    <button class="restart-btn" onclick="restartGame()">ÿ•ÿπÿßÿØÿ© ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ©</button>
    <button class="back-btn" onclick="goBackToStart()">ÿ±ÿ¨Ÿàÿπ</button>
  </div>

  <script>
    const startScreen = document.getElementById("startScreen");
    const countdownScreen = document.getElementById("countdownScreen");
    const countdownNumber = document.getElementById("countdownNumber");
    const gameOverScreen = document.getElementById("gameOverScreen");
    const finalScore = document.getElementById("finalScore");
    const game = document.getElementById("game");
    const player = document.getElementById("player");
    const obstacle = document.getElementById("obstacle");
    const scoreDisplay = document.getElementById("score");
    const highScoreDisplay = document.getElementById("highScore");

    let score = 0;
    let highScore = localStorage.getItem("highScore") || 0;
    let isGameOver = false;
    let scoreInterval;
    let speed = 3.5;
    let gameStarted = false;
    const obstacleImages = [
      'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect x="20" y="40" width="60" height="60" fill="gray"/></svg>',
      'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect x="30" y="50" width="40" height="50" fill="brown"/><ellipse cx="50" cy="40" rx="30" ry="20" fill="green"/></svg>',
      'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="70" r="30" fill="brown"/><circle cx="30" cy="50" r="10" fill="brown"/><circle cx="70" cy="50" r="10" fill="brown"/></svg>'
    ];

    highScoreDisplay.textContent = `ÿßŸÑÿ£ÿπŸÑŸâ: ${highScore}`;

    function startCountdown() {
      startScreen.style.display = "none";
      countdownScreen.style.display = "flex";
      let count = 3;
      countdownNumber.textContent = count;

      const interval = setInterval(() => {
        count--;
        if (count === 0) {
          clearInterval(interval);
          countdownScreen.style.display = "none";
          startGame();
        } else {
          countdownNumber.textContent = count;
        }
      }, 1000);
    }

    function startGame() {
      game.style.display = "block";
      isGameOver = false;
      gameStarted = true;
      score = 0;
      speed = 3.5;
      scoreDisplay.textContent = `ÿßŸÑŸÜŸÇÿßÿ∑: 0`;
      obstacle.style.right = "-60px";
      obstacle.style.display = "block";

      // Reset obstacle animation
      obstacle.style.animation = "none";
      void obstacle.offsetWidth; // Trigger reflow
      
      setTimeout(() => {
        obstacle.style.animation = `moveObstacle ${speed}s linear infinite`;
        startScoring();
      }, 100);
    }

    function jump() {
      if (!player.classList.contains("jump") && !isGameOver && gameStarted) {
        player.classList.add("jump");
        setTimeout(() => {
          player.classList.remove("jump");
        }, 500);
      }
    }

    document.addEventListener("keydown", (e) => {
      if (e.code === "Space") jump();
    });
    document.addEventListener("click", jump);

    function startScoring() {
      updateObstacleImage();
      scoreInterval = setInterval(() => {
        if (isGameOver) return;
        score++;
        scoreDisplay.textContent = `ÿßŸÑŸÜŸÇÿßÿ∑: ${score}`;
        if (score % 100 === 0 && speed > 1.5) {
          speed -= 0.2;
          obstacle.style.animation = `moveObstacle ${speed}s linear infinite`;
        }
        if (score % 20 === 0) {
          updateObstacleImage();
        }
      }, 1000);
    }

    function updateObstacleImage() {
      const img = obstacleImages[Math.floor(Math.random() * obstacleImages.length)];
      obstacle.style.backgroundImage = `url('${img}')`;
    }

    function checkCollision() {
      if (isGameOver || !gameStarted) return;

      const playerRect = player.getBoundingClientRect();
      const obstacleRect = obstacle.getBoundingClientRect();

      // More accurate collision detection
      if (
        playerRect.right > obstacleRect.left &&
        playerRect.left < obstacleRect.right &&
        playerRect.bottom > obstacleRect.top &&
        playerRect.top < obstacleRect.bottom
      ) {
        endGame();
      }
    }

    // Check for collisions at 60fps
    setInterval(checkCollision, 1000/60);

    function endGame() {
      if (isGameOver) return;
      
      isGameOver = true;
      gameStarted = false;
      clearInterval(scoreInterval);
      game.classList.add("flash");
      setTimeout(() => game.classList.remove("flash"), 200);
      obstacle.style.animation = "none";
      finalScore.textContent = `ŸÜÿ™Ÿäÿ¨ÿ™ŸÉ: ${score}`;
      gameOverScreen.style.display = "flex";

      if (score > highScore) {
        highScore = score;
        localStorage.setItem("highScore", score);
        highScoreDisplay.textContent = `ÿßŸÑÿ£ÿπŸÑŸâ: ${score}`;
      }
    }

    function restartGame() {
      gameOverScreen.style.display = "none";
      game.style.display = "none";
      obstacle.style.animation = "none";
      obstacle.style.right = "-60px";
      startCountdown();
    }

    function goBackToStart() {
      gameOverScreen.style.display = "none";
      game.style.display = "none";
      startScreen.style.display = "flex";
      obstacle.style.animation = "none";
      obstacle.style.right = "-60px";
      gameStarted = false;
    }
  </script>
</body>
</html>
